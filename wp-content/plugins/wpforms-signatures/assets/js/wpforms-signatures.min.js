var WPFormsSignatures=window.WPFormsSignatures||function(t,i,n){"use strict";var e={config:{windowWidth:!1,pixelRatio:Math.max(i.devicePixelRatio||1,1),watching:!1,watchingRate:300},signatures:{},signaturesDisabled:[],getCanvas:function(t){var i=t.get(0);return i.width=i.offsetWidth*e.config.pixelRatio,i.height=i.offsetHeight*e.config.pixelRatio,i.getContext("2d").scale(e.config.pixelRatio,e.config.pixelRatio),i},cropCanvas:function(i){var n=t.createElement("canvas"),e=n.getContext("2d");n.width=i.width,n.height=i.height,e.drawImage(i,0,0);var a,r,s,g,o,u=n.width,c=n.height,d={x:[],y:[]},h=e.getImageData(0,0,n.width,n.height);for(r=0;r<c;r++)for(a=0;a<u;a++)o=4*(r*u+a),h.data[o+3]>0&&(d.x.push(a),d.y.push(r));return d.x.sort(function(t,i){return t-i}),d.y.sort(function(t,i){return t-i}),s=d.x.length-1,u=d.x[s]-d.x[0],c=d.y[s]-d.y[0],g=e.getImageData(d.x[0],d.y[0],u,c),n.width=u,n.height=c,e.putImageData(g,0,0),n.toDataURL()},watchSignatures:function(){if(e.signaturesDisabled.length<1)return clearInterval(e.config.watching),void(e.config.watching=!1);for(var t in e.signaturesDisabled){var i=n("#"+e.signaturesDisabled[t]);i.is(":hidden")||(e.signaturesDisabled.splice(t,1),a.loadSignature(i))}}},a={init:function(){n(t).on("wpformsReady",a.ready)},ready:function(){e.config.windowWidth=n(i).width(),a.loadSignatures(),n(t).on("click",".wpforms-signature-clear",function(t){t.preventDefault(),a.resetSignature(n(this).parent().find(".wpforms-signature-canvas"))}),n(i).resize(a.resetSignatures),e.signaturesDisabled.length>0&&(e.config.watching=setInterval(e.watchSignatures,e.config.watchingRate))},loadSignatures:function(){n(".wpforms-signature-canvas").each(function(){a.loadSignature(n(this))})},loadSignature:function(t){var i=t.closest(".wpforms-field-signature").find(".wpforms-signature-input"),n=t.attr("id"),a=e.getCanvas(t),r=t.data("color");t.is(":hidden")?e.signaturesDisabled.push(n):e.signatures[n]=new SignaturePad(a,{penColor:r,onEnd:function(){i.val(e.cropCanvas(a)).trigger("input change").valid()}})},resetSignatures:function(){e.config.windowWidth!==n(i).width()&&n(".wpforms-signature-canvas").each(function(){a.resetSignature(n(this))})},resetSignature:function(t){var i=t.closest(".wpforms-field-signature").find(".wpforms-signature-input"),a=t.attr("id");e.signatures[a]&&e.signatures[a].clear(),i.val("").trigger("input change"),t.is(":hidden")&&(-1===n.inArray(a,e.signaturesDisabled)&&e.signaturesDisabled.push(a),e.signatures[a]&&delete e.signatures[a],e.config.watching||(e.config.watching=setInterval(e.watchSignatures,e.config.watchingRate)))}};return a}(document,window,jQuery);WPFormsSignatures.init();